[cite_start]name: First CI/CD Pipeline # 工作流名称 [cite: 27]

on:
  [cite_start]push: # 触发条件: 推送到 main 或 master 分支时触发 [cite: 30, 32]
    branches: [ "main", "master"]
  [cite_start]workflow_dispatch: # 允许手动在 Actions 页面点击按钮触发 [cite: 60]

jobs:
  build-job:
    [cite_start]runs-on: ubuntu-latest # 指定运行环境 [cite: 62, 63]
    steps:
      - name: Run build script
        run: echo "Hello, ${{ github.actor }}!" # ${{ github.actor}} 会自动替换为您的 GitHub 用户名 [cite: 64, 65]
  
  test-job1:
    [cite_start]needs: build-job # 依赖 build-job，确保构建成功后才运行测试 [cite: 66, 67]
    runs-on: ubuntu-latest
    steps:
      - name: Run test script
        [cite_start]run: echo "This job tests something" [cite: 69, 70]

  test-job2:
    [cite_start]needs: build-job # 同样依赖 build-job，test-job1 和 test-job2 将并行运行 [cite: 71, 72]
    runs-on: ubuntu-latest
    steps:
      - name: Run longer test script
        run: |
          echo "This job tests something, but takes more time than test-job1."
          echo "After the echo commands complete, it runs the sleep command for 20 seconds"
          echo "which simulates a test that runs 20 seconds longer than test-job1"
          sleep 20 # 模拟一个耗时较长的作业 [cite: 76, 78-88]

  deploy-prod:
    [cite_start]needs: [test-job1, test-job2] # 只有当两个测试作业都成功后才运行部署 [cite: 91, 94]
    runs-on: ubuntu-latest
    [cite_start]environment: production # 可选的 GitHub 部署环境功能 [cite: 101]
    steps:
      - name: Deploy script
        [cite_start]run: echo "This job deploys something from the ${{ github.ref_name }} branch." [cite: 102, 104, 105]
